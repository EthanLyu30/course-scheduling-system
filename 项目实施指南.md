# 双向选择排课系统 - 项目实施指南

> 本文档用于指导项目的开发环境配置、部署运行和代码结构说明，便于在GitHub上进行项目管理和团队协作。

---

## 一、项目概述

### 1.1 项目简介

双向选择排课系统是一个支持学生时间偏好的智能排课平台，由三个子系统组成：

| 子系统 | 说明 | 后端端口 | 前端端口 |
|--------|------|----------|----------|
| **学生排课子系统** | 学生设置时间偏好、选择课程、表达意愿、查看结果 | 8081 | 5173 |
| **教师排课子系统** | 教师设置授课时间、教室偏好、查看课表 | 8082 | 5174 |
| **教务协调子系统** | 汇总意愿、执行排课算法、协调冲突、发布课表 | 8083 | 5175 |

### 1.2 技术栈

| 类别 | 技术选型 | 版本要求 |
|------|----------|----------|
| 前端框架 | Vue.js 3 | 3.4+ |
| 前端构建 | Vite | 5.0+ |
| UI组件库 | Element Plus | 2.4+ |
| 状态管理 | Pinia | 2.1+ |
| HTTP客户端 | Axios | 1.6+ |
| 后端框架 | Spring Boot | 3.2+ |
| ORM框架 | MyBatis-Plus | 3.5+ |
| 接口文档 | Knife4j | 4.3+ |
| 数据库 | MySQL | 8.0+ |
| JDK | OpenJDK | 17+ |
| Node.js | Node.js | 18+ |
| 包管理器 | npm / pnpm | npm 9+ / pnpm 8+ |

---

## 二、环境配置

### 2.1 必装软件

#### （1）JDK 17

下载地址：https://adoptium.net/

```powershell
# 验证安装
java -version
# 输出示例：openjdk version "17.0.x"
```

配置环境变量：
- `JAVA_HOME` = JDK安装路径（如 `C:\Program Files\Eclipse Adoptium\jdk-17`）
- `Path` 添加 `%JAVA_HOME%\bin`

#### （2）Node.js 18+

下载地址：https://nodejs.org/

```powershell
# 验证安装
node -v    # 输出：v18.x.x 或更高
npm -v     # 输出：9.x.x 或更高

# 可选：安装pnpm（更快的包管理器）
npm install -g pnpm
```

#### （3）MySQL 8.0

下载地址：https://dev.mysql.com/downloads/mysql/

安装时记住设置的root密码。

```powershell
# 验证安装（需要MySQL在PATH中，或进入安装目录）
mysql -V
# 输出：mysql  Ver 8.0.x
```

#### （4）Git

下载地址：https://git-scm.com/

```powershell
# 验证安装
git --version
```

### 2.2 VS Code 扩展

在VS Code中安装以下扩展：

| 扩展名称 | 扩展ID | 用途 |
|----------|--------|------|
| Extension Pack for Java | `vscjava.vscode-java-pack` | Java开发全套支持 |
| Spring Boot Extension Pack | `vmware.vscode-boot-dev-pack` | Spring Boot支持 |
| Vue - Official | `Vue.volar` | Vue 3语法支持 |
| Vite | `antfu.vite` | Vite项目支持 |
| ESLint | `dbaeumer.vscode-eslint` | 代码规范检查 |
| Prettier | `esbenp.prettier-vscode` | 代码格式化 |
| MySQL | `cweijan.vscode-mysql-client2` | 数据库管理 |

### 2.3 数据库初始化

```sql
-- 创建数据库
CREATE DATABASE IF NOT EXISTS course_scheduling 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;

-- 创建用户（可选，也可使用root）
CREATE USER 'schedule'@'localhost' IDENTIFIED BY 'schedule123';
GRANT ALL PRIVILEGES ON course_scheduling.* TO 'schedule'@'localhost';
FLUSH PRIVILEGES;
```

---

## 三、项目结构

### 3.1 整体目录结构

```
course-scheduling-system/              # 项目根目录
├── README.md                          # 项目说明
├── .gitignore                         # Git忽略文件
├── docs/                              # 文档目录
│   ├── 需求分析.md
│   ├── 概要设计.md
│   └── 数据库设计.md
│
├── database/                          # 数据库脚本
│   ├── schema.sql                     # 建表语句
│   └── init-data.sql                  # 初始数据
│
├── student-system/                    # 学生排课子系统
│   ├── student-frontend/              # 前端项目
│   └── student-backend/               # 后端项目
│
├── teacher-system/                    # 教师排课子系统
│   ├── teacher-frontend/
│   └── teacher-backend/
│
└── admin-system/                      # 教务协调子系统
    ├── admin-frontend/
    └── admin-backend/
```

### 3.2 学生子系统前端结构

```
student-frontend/
├── index.html                         # 入口HTML
├── package.json                       # 项目配置
├── vite.config.js                     # Vite配置
├── .env.development                   # 开发环境变量
├── .env.production                    # 生产环境变量
│
├── public/                            # 静态资源
│   └── favicon.ico
│
└── src/
    ├── main.js                        # 应用入口
    ├── App.vue                        # 根组件
    │
    ├── api/                           # API请求封装
    │   ├── index.js                   # Axios实例
    │   ├── preference.js              # 时间偏好API
    │   ├── course.js                  # 课程API
    │   ├── wish.js                    # 意愿API
    │   └── schedule.js                # 排课结果API
    │
    ├── views/                         # 页面组件
    │   ├── PreferencePage.vue         # 时间偏好设置
    │   ├── CoursePage.vue             # 课程选择浏览
    │   ├── WishPage.vue               # 意愿表达提交
    │   ├── SchedulePage.vue           # 排课结果查看
    │   └── FeedbackPage.vue           # 反馈页面
    │
    ├── components/                    # 公共组件
    │   ├── TimeGrid.vue               # 时间网格组件
    │   ├── CourseCard.vue             # 课程卡片
    │   ├── WishItem.vue               # 意愿项
    │   └── ScheduleTable.vue          # 课表组件
    │
    ├── stores/                        # Pinia状态管理
    │   ├── user.js                    # 用户状态
    │   ├── preference.js              # 偏好状态
    │   └── wish.js                    # 意愿状态
    │
    ├── router/                        # 路由配置
    │   └── index.js
    │
    ├── utils/                         # 工具函数
    │   ├── request.js                 # 请求封装
    │   └── export.js                  # 导出工具
    │
    └── styles/                        # 样式文件
        └── main.css
```

### 3.3 学生子系统后端结构

```
student-backend/
├── pom.xml                            # Maven配置
├── mvnw                               # Maven Wrapper (Linux/Mac)
├── mvnw.cmd                           # Maven Wrapper (Windows)
│
└── src/
    ├── main/
    │   ├── java/com/schedule/student/
    │   │   ├── StudentApplication.java           # 启动类
    │   │   │
    │   │   ├── controller/                       # 控制层
    │   │   │   ├── PreferenceController.java     # 时间偏好接口
    │   │   │   ├── CourseController.java         # 课程接口
    │   │   │   ├── WishController.java           # 意愿接口
    │   │   │   ├── ScheduleController.java       # 排课结果接口
    │   │   │   └── FeedbackController.java       # 反馈接口
    │   │   │
    │   │   ├── service/                          # 业务层
    │   │   │   ├── PreferenceService.java
    │   │   │   ├── CourseService.java
    │   │   │   ├── WishService.java
    │   │   │   ├── ScheduleService.java
    │   │   │   └── impl/                         # 实现类
    │   │   │
    │   │   ├── mapper/                           # 数据访问层
    │   │   │   ├── StudentMapper.java
    │   │   │   ├── PreferenceMapper.java
    │   │   │   ├── CourseMapper.java
    │   │   │   ├── WishMapper.java
    │   │   │   └── ScheduleMapper.java
    │   │   │
    │   │   ├── entity/                           # 实体类
    │   │   │   ├── Student.java
    │   │   │   ├── TimePreference.java
    │   │   │   ├── TimeSlot.java
    │   │   │   ├── Course.java
    │   │   │   ├── Wish.java
    │   │   │   ├── Schedule.java
    │   │   │   └── Feedback.java
    │   │   │
    │   │   ├── dto/                              # 数据传输对象
    │   │   │   ├── PreferenceDTO.java
    │   │   │   ├── WishDTO.java
    │   │   │   └── ScheduleDTO.java
    │   │   │
    │   │   ├── vo/                               # 视图对象
    │   │   │   ├── Result.java                   # 统一响应
    │   │   │   └── PageResult.java               # 分页响应
    │   │   │
    │   │   └── config/                           # 配置类
    │   │       ├── CorsConfig.java               # 跨域配置
    │   │       ├── MyBatisPlusConfig.java        # MP配置
    │   │       └── Knife4jConfig.java            # 接口文档配置
    │   │
    │   └── resources/
    │       ├── application.yml                   # 主配置
    │       ├── application-dev.yml               # 开发环境配置
    │       ├── application-prod.yml              # 生产环境配置
    │       └── mapper/                           # MyBatis XML
    │           └── *.xml
    │
    └── test/                                     # 测试代码
        └── java/com/schedule/student/
```

---

## 四、快速开始

### 4.1 克隆项目

```powershell
# 克隆仓库
git clone https://github.com/你的用户名/course-scheduling-system.git
cd course-scheduling-system
```

### 4.2 初始化数据库

```powershell
# 使用MySQL客户端执行SQL脚本
mysql -u root -p < database/schema.sql
mysql -u root -p < database/init-data.sql
```

### 4.3 启动学生子系统后端

```powershell
cd student-system/student-backend

# 首次运行需要下载依赖（可能较慢）
./mvnw.cmd spring-boot:run

# 或者在VS Code中直接运行StudentApplication.java
```

启动成功后访问：
- API服务：http://localhost:8081
- 接口文档：http://localhost:8081/doc.html

### 4.4 启动学生子系统前端

```powershell
# 新开一个终端
cd student-system/student-frontend

# 安装依赖（首次）
npm install

# 启动开发服务器
npm run dev
```

启动成功后访问：http://localhost:5173

### 4.5 一键启动脚本（可选）

在项目根目录创建 `start-student.ps1`：

```powershell
# start-student.ps1
Write-Host "启动学生排课子系统..." -ForegroundColor Green

# 启动后端（后台运行）
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd student-system/student-backend; ./mvnw.cmd spring-boot:run"

# 等待后端启动
Start-Sleep -Seconds 10

# 启动前端（后台运行）
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd student-system/student-frontend; npm run dev"

Write-Host "启动完成！" -ForegroundColor Green
Write-Host "前端地址: http://localhost:5173" -ForegroundColor Cyan
Write-Host "后端接口文档: http://localhost:8081/doc.html" -ForegroundColor Cyan
```

---

## 五、配置说明

### 5.1 后端配置文件

**application.yml**（公共配置）：

```yaml
spring:
  application:
    name: student-schedule-service
  profiles:
    active: dev

server:
  port: 8081
  servlet:
    context-path: /api

mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.schedule.student.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```

**application-dev.yml**（开发环境）：

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/course_scheduling?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
    username: root
    password: 你的密码

# 接口文档配置
knife4j:
  enable: true
  setting:
    language: zh_cn
```

### 5.2 前端配置文件

**.env.development**：

```properties
# 开发环境
VITE_APP_TITLE=学生排课子系统
VITE_APP_BASE_API=http://localhost:8081/api
```

**.env.production**：

```properties
# 生产环境
VITE_APP_TITLE=学生排课子系统
VITE_APP_BASE_API=/api
```

**vite.config.js**：

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8081',
        changeOrigin: true
      }
    }
  }
})
```

---

## 六、子系统接口对接

### 6.1 共享数据表

三个子系统共享以下数据表：

| 表名 | 主要维护方 | 说明 |
|------|------------|------|
| `student` | 教务协调 | 学生基本信息 |
| `teacher` | 教务协调 | 教师基本信息 |
| `course` | 教务协调 | 课程信息 |
| `classroom` | 教务协调 | 教室信息 |
| `schedule` | 教务协调 | 最终排课结果（只读） |
| `student_preference` | 学生端 | 学生时间偏好 |
| `student_wish` | 学生端 | 学生选课意愿 |
| `teacher_preference` | 教师端 | 教师时间偏好 |
| `teacher_wish` | 教师端 | 教师授课意愿 |

### 6.2 跨系统API调用

学生端调用教务协调系统的API：

```java
// 在student-backend中配置教务系统地址
@Value("${external.admin-system.url}")
private String adminSystemUrl;

// 提交意愿到教务系统
public void submitWishToAdmin(List<WishDTO> wishes) {
    restTemplate.postForEntity(
        adminSystemUrl + "/api/wishes/student",
        wishes,
        Result.class
    );
}

// 获取最终排课结果
public ScheduleDTO getScheduleFromAdmin(String studentId) {
    return restTemplate.getForObject(
        adminSystemUrl + "/api/schedule/student/" + studentId,
        ScheduleDTO.class
    );
}
```

### 6.3 接口规范

所有子系统遵循统一的接口规范：

**统一响应格式**：

```json
{
  "code": 200,
  "message": "操作成功",
  "data": { ... },
  "timestamp": 1702300800000
}
```

**统一错误码**：

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未登录 |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## 七、开发规范

### 7.1 Git工作流

```powershell
# 功能开发流程
git checkout -b feature/时间偏好设置    # 创建功能分支
# ... 开发代码 ...
git add .
git commit -m "feat: 实现时间偏好设置功能"
git push origin feature/时间偏好设置
# 在GitHub上创建Pull Request
```

**提交信息规范**：

| 类型 | 说明 |
|------|------|
| `feat` | 新功能 |
| `fix` | Bug修复 |
| `docs` | 文档更新 |
| `style` | 代码格式调整 |
| `refactor` | 代码重构 |
| `test` | 测试相关 |
| `chore` | 构建/工具相关 |

### 7.2 代码规范

**后端（Java）**：
- 遵循阿里巴巴Java开发规范
- 类名使用大驼峰：`PreferenceService`
- 方法名使用小驼峰：`getPreferenceById`
- 常量使用全大写下划线：`MAX_RETRY_COUNT`

**前端（JavaScript/Vue）**：
- 遵循ESLint + Prettier规范
- 组件名使用大驼峰：`TimeGrid.vue`
- 变量使用小驼峰：`preferenceList`
- 常量使用全大写下划线：`API_BASE_URL`

---

## 八、常见问题

### Q1: Maven下载依赖很慢怎么办？

在 `student-backend/pom.xml` 中添加阿里云镜像：

```xml
<repositories>
    <repository>
        <id>aliyun</id>
        <url>https://maven.aliyun.com/repository/public</url>
    </repository>
</repositories>
```

或配置全局 `~/.m2/settings.xml`。

### Q2: npm install 很慢怎么办？

```powershell
# 设置淘宝镜像
npm config set registry https://registry.npmmirror.com

# 或使用pnpm
npm install -g pnpm
pnpm install
```

### Q3: 端口被占用怎么办？

```powershell
# 查看端口占用
netstat -ano | findstr :8081

# 结束占用进程
taskkill /PID 进程ID /F
```

### Q4: 跨域请求报错怎么办？

确保后端已配置CORS：

```java
@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedOriginPattern("*");
        config.addAllowedMethod("*");
        config.addAllowedHeader("*");
        config.setAllowCredentials(true);
        
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);
        return new CorsFilter(source);
    }
}
```

---

## 九、部署说明

### 9.1 本地运行（开发/演示）

按照第四章"快速开始"操作即可。

### 9.2 打包构建

**后端打包**：

```powershell
cd student-system/student-backend
./mvnw.cmd clean package -DskipTests

# 生成的jar包在 target/student-backend-1.0.0.jar
```

**前端打包**：

```powershell
cd student-system/student-frontend
npm run build

# 生成的静态文件在 dist/ 目录
```

### 9.3 生产部署（可选）

如需部署到服务器，可参考以下方案：

1. **传统部署**：将jar包和dist目录部署到云服务器，使用Nginx反向代理
2. **Docker部署**：编写Dockerfile，构建镜像部署
3. **云平台部署**：使用阿里云、腾讯云等PaaS平台一键部署

---

## 十、联系与支持

- **项目仓库**：https://github.com/你的用户名/course-scheduling-system
- **问题反馈**：在GitHub Issues中提交
- **作者**：吕霄阳
- **学号**：2327406032
